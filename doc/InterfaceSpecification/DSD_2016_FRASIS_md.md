# DSD 2016 Facial Recognition Authentication Service Interface Specifications


## CONTENTS

### Introduction

### Authentication server

### Facilitator

### Database

### Errors

### Service Request/Response Sequences


## INTRODUCTION

The Facial Recognition Authentication Service is an image-based authentication service. It functions like standard password-based authentication services, but uses end-user provided images instead of passwords. Client applications can make register requests and login requests. Register requests require an array of image objects and on success return a userId required to make a login request. Login requests authenticate previously registered users using the userId returned from a successful register request and an image.


## AUTHENTICATION SERVER


### Service register POST ContentType: "application/json"
// Registers an array of images to a new user with the service. Returns a unique userId string after a successful registration.

#### request:

{
    "pictures" : [  // array, picture objects
    	{
            "pictureId" : 1,  // int
    	       "base64" : "asdnasljdbjasbsdkajbflksbfkasbfhfa"  // base64 image string
        },
    	{
            "pictureId" : 2,  // int
    	       "base64" : "Baseojdasfjbsjodsjabfkjbsadkñfjh"  // base64 image string
    	}
    ]
}

#### response BAD:

{
	"success" : false,  // boolean, false if either the facilitator or database return false
	"pictureErrors" : [  // array, errors returned from the facilitator or database
    	{
            "pictureId" : 1,  // int, from the picture object that generated the error
    		"errorCode" : 1,  // int
    		"errorMessage" : "File too large."  // string
    	},
    	{
    		"pictureId" : 2,  // int, from the picture object that generated the error
    		"errorCode" : 2,  // int
    		"errorMessage" : "There\"s not a face in that picture."  // string
    	}
	]
}

#### response GOOD:

{
	"success" : true,  // boolean, true if both facilitator and server return true
	"userId" : "96cb7a81a34dd0888ea4fedbb42745e7893179b1"  // string, generated by the database
}


### Service login POST ContentType: "application/json"
// Authenticates an existing user with an image. Requires the userId string returned after a successful login request.

#### request:

{
	"userId" : "96cb7a81a34dd0888ea4fedbb42745e7893179b1",  // string, the string returned after a successful register request
	"picture" : "asdnasljdbjasbsdkajbflksbfkasbfhfa"  // base64 image string
}

#### response BAD:

{
	"success" : false,  // boolean, false if either the facilitator or database return false
	"errors" : [  // array, error objects
		{
			"errorCode" : 1,  // int
			"errorMessage" : "File too large."  // string
		},
		{
			"errorCode" : 2,  // int
			"errorMessage" : "There\"s not a face in that picture."  // string
		}
	]

}

#### response GOOD:

{
	"success" : true  // boolean, true if both facilitator and server return true
}


## FACILITATOR


### Service register POST ContentType: "application/json"
// Registers an array of images to a new user with one or more facial recognition services.

{
    "pictures" : [  // array, picture objects
    	{
            "pictureId" : 1,  // int
    	       "base64" : "asdnasljdbjasbsdkajbflksbfkasbfhfa"  // base64 image string
        },
    	{
            "pictureId" : 2,  // int
    	       "base64" : "Baseojdasfjbsjodsjabfkjbsadkñfjh"  // base64 image string
    	}
    ]
}

#### response BAD:

{
	"success" : false,  // boolean, false when a user was not registered
	"pictureErrors" : [  // array, error objects
    	{
            "pictureId" : 1,  // int, from the picture object that generated the error
    		"errorCode" : 1,  // int
    		"errorMessage" : "File too large."  // string
    	},
    	{
    		"pictureId" : 2,  // int, from the picture object that generated the error
    		"errorCode" : 2,  // int
    		"errorMessage" : "There\"s not a face in that picture."  // string
    	}
	]
}

#### response GOOD:

{
    "success" : true, // boolean, true when a user has been registered
    "facilitatorIds" : [  // array, facilitatorId objects, one for each facial recognition service
        {
            "facId" : "696c3ecd355c03bf86ad029a68b931cd",  //  string, an id returned from a facial recognition service
            "facType" : "fpp"  // string, the facial recognition service name, identifies the service
        },
        {
            "facId" : "768dad68asf7sd87f6s8adds87f6",  //  string, an id returned from a facial recognition service
            "facType" : "microsoft"  // string, the facial recognition service name, identifies the service
        }
    ]
}


### Service login POST ContentType: "application/json"
// Authenticates an existing user with an image.

#### request:

{
    "facilitatorIds" : [  // array, facilitatorId objects, one for each facial recognition service
        {
            "facId" : "696c3ecd355c03bf86ad029a68b931cd",  //  string, an id returned from a facial recognition service
            "facType" : "fpp"  // string, the facial recognition service name, identifies the service
        },
        {
            "facId" : "768dad68asf7sd87f6s8adds87f6",  //  string, an id returned from a facial recognition service
            "facType" : "microsoft"  // string, the facial recognition service name, identifies the service
        }
    ],
	"picture" : "asdnasljdbjasbsdkajbflksbfkasbfhfa"  // base64 image string
}

#### response BAD:

{
	"success" : false,  // boolean, false if the facial recognition failed
	"errors" : [  // array, error objects
		{
			"errorCode" : 1,  // int
			"errorMessage" : "File too large."  // string
		},
		{
			"errorCode" : 2,  // int
			"errorMessage" : "There\"s not a face in that picture."  // string
		}
	]
}

#### response GOOD:

{
	"success" : true  // boolean, true if the login was a success
}


## DATABASE


### Service register POST ContentType: "application/json"
// Stores new user registration information in the database. Returns a unique userId string after a successful registration.

#### request:

{
	"facilitatorIds" : [  // array, facilitatorId objects, one for each facial recognition service
        {
            "facId" : "696c3ecd355c03bf86ad029a68b931cd",  //  string, an id returned from a facial recognition service
            "facType" : "fpp"  // string, the facial recognition service name, identifies the service
        },
        {
            "facId" : "768dad68asf7sd87f6s8adds87f6",  //  string, an id returned from a facial recognition service
            "facType" : "microsoft"  // string, the facial recognition service name, identifies the service
        }
    ],
	"pictures" : [  // array, picture objects
    	{
            "pictureId" : 1,  // int
    	       "base64" : "asdnasljdbjasbsdkajbflksbfkasbfhfa"  // base64 image string
        },
    	{
            "pictureId" : 2,  // int
    	       "base64" : "Baseojdasfjbsjodsjabfkjbsadkñfjh"  // base64 image string
    	}
    ]
}

#### response BAD:

{
	"success" : false,  // boolean, false if the registration database actions failed
	"errors" : [  // array, error objects
		{
			"errorCode" : 1,  // int
			"errorMessage" : "File too large."  // string
		},
		{
			"errorCode" : 2,  // int
			"errorMessage" : "There\"s not a face in that picture."  // string
		}
	]
}

#### response GOOD:

{
    "success" : true,  // boolean, true when register is a success
    "userId" : "96cb7a81a34dd0888ea4fedbb42745e7893179b1" // string, created by database on successful register request
}


### Service login POST ContentType: "application/json"
// Verifies if the userId is in the database. Returns the array of facilitatorIds necessary for a facilitator login request.

#### request :

{
	"userId" : "96cb7a81a34dd0888ea4fedbb42745e7893179b1"  // string, generated by the user
}

#### response BAD:

{
	"success" : false,  // boolean, false if the userId is not in the database
	"errors" : [  // array, error objects
		{
			"errorCode" : 1,  // int
			"errorMessage" : "File too large."  // string
		},
		{
			"errorCode" : 2,  // int
			"errorMessage" : "There\"s not a face in that picture."  // string
		}
	]
}

#### response GOOD:

{
	"success" : true,  // boolean, true if the userId is in the database
	"facilitatorIds" : [  // array, facilitatorId objects, one for each facial recognition service
        {
            "facId" : "696c3ecd355c03bf86ad029a68b931cd",  //  string, an id returned from a facial recognition service
            "facType" : "fpp"  // string, the facial recognition service name, identifies the service
        },
        {
            "facId" : "768dad68asf7sd87f6s8adds87f6",  //  string, an id returned from a facial recognition service
            "facType" : "microsoft"  // string, the facial recognition service name, identifies the service
        }
    ],
}


### ERRORS

CODE 		MESSAGE
1			"File is too large"
2			"There\"s not a face in that picture."
3			"The image has bad quality."
4			""
... (more to come)


### SERVICE REQUEST/RESPONSE SEQUENCES

#### register GOOD

1) client app sends register request to authentication server
2) authentication server sends register request to facilitator
3) facilitator responds to authentication server
4) authentication server sends register request to database
5) database responds to authentication server
6) authentication server responds to client app

#### login GOOD

1) client app sends login request to authentication server
2) authentication server sends login request to database
3) database responds to authentication server
4) authentication server sends login request to facilitator
5) facilitator responds to authentication server
6) authentication server responds to client app